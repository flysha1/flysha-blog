---
order: 1
date: 2018-01-01
category:
  - å‰ç«¯æŠ€æœ¯
tag:
  - JavaScript
---

# åŸå‹é“¾

ECMAScript ä¸­æè¿°äº†åŸå‹é“¾çš„æ¦‚å¿µï¼Œå¹¶å°†åŸå‹é“¾ä½œä¸ºå®ç°ç»§æ‰¿çš„ä¸»è¦æ–¹æ³•ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨åŸå‹è®©ä¸€ä¸ªå¼•ç”¨ç±»å‹ç»§æ‰¿å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚

ææ‡‚åŸå‹å¯¹è±¡å’ŒåŸå‹é“¾å…¶å®å°±æ˜¯ææ‡‚ `prototype`ã€`__proto__` å’Œ `constructor` ä¹‹é—´çš„ç›¸äº’å…³ç³»ã€‚

æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹å¹¶é™„åŠ å›¾ä¾‹é˜è¿°è¿™ç§å¤æ‚çš„ç›¸äº’å…³ç³»ã€‚

![](/blog/assets/images/ç»§æ‰¿åŸå‹.svg)

**å›¾ä¾‹**

- çº¢è‰²ç®­å¤´è¡¨ç¤º `__proto__` å±æ€§æŒ‡å‘
- ç»¿è‰²ç®­å¤´è¡¨ç¤º `prototype` å±æ€§æŒ‡å‘
- æ£•è‰²ç®­å¤´è¡¨ç¤ºæœ¬èº«å…·æœ‰çš„ `constructor` å±æ€§
- è“è‰²æ–¹å—è¡¨ç¤ºå¯¹è±¡
- æµ…ç»¿æ–¹å—è¡¨ç¤ºå‡½æ•°

åœ¨ JavaScript ä¸­ï¼Œè¿™ä¸‰è€…ä¹‹é—´ä¾é™„åœ¨ä¸åŒçš„å¼•ç”¨å¯¹è±¡ç±»å‹ä¸Šã€‚

- å¯¹è±¡ï¼š`__proto__` å’Œ `constructor` æ˜¯å¯¹è±¡ç‹¬æœ‰çš„ã€‚
- å‡½æ•°ï¼š`prototype` æ˜¯å‡½æ•°ç‹¬æœ‰çš„ã€‚ä½†æ˜¯å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥å‡½æ•°ä¹Ÿæœ‰ `__proto__` å’Œ `constructor`ã€‚

## æ˜¾å¼åŸå‹

![](/blog/assets/images/æ˜¾å¼åŸå‹.svg)

æ˜¾å¼åŸå‹å¯¹è±¡ `prototype` ç”±**å‡½æ•°æ‰€ç‹¬æœ‰**ï¼Œå®ƒæ˜¯ä»**ä¸€ä¸ªå‡½æ•°æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡**ã€‚å®ƒçš„å«ä¹‰æ˜¯**å‡½æ•°çš„åŸå‹å¯¹è±¡**ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå‡½æ•°ï¼ˆå…¶å®æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä½œä¸ºæ„é€ å‡½æ•°ï¼‰æ‰€åˆ›å»ºçš„å®ä¾‹çš„åŸå‹å¯¹è±¡ã€‚ç”±æ­¤å¯çŸ¥ï¼š`foo.__proto__ === Foo.prototype`ï¼Œå®ƒä»¬ä¸¤ä¸ªå®Œå…¨ä¸€æ ·ã€‚

é‚£ `prototype` å±æ€§ä½œç”¨åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒçš„ä½œç”¨å°±æ˜¯åŒ…å«å¯ä»¥ç”±ç‰¹å®šç±»å‹çš„æ‰€æœ‰å®ä¾‹å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è®©è¯¥å‡½æ•°çš„å®ä¾‹åŒ–å¯¹è±¡ä»¬éƒ½å¯ä»¥æ‰¾åˆ°å…¬ç”¨çš„å±æ€§å’Œæ–¹æ³•ã€‚

**ä»»ä½•å‡½æ•°åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œå…¶å®ä¼šé»˜è®¤åŒæ—¶åˆ›å»ºè¯¥å‡½æ•°çš„ `prototype` å¯¹è±¡ã€‚**

## éšå¼åŸå‹

![](/blog/assets/images/éšå¼åŸå‹.svg)

åœ¨ JavaScript ä¸­çš„**å¯¹è±¡**ä¸­éƒ½æœ‰ä¸€ä¸ª `__proto__` å±æ€§ï¼Œä»ä¸Šå›¾å¯ä»¥çœ‹å‡º**ä¸€ä¸ªå¯¹è±¡æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡**ï¼Œå³æŒ‡å‘ç›¸å¯¹åº”çš„å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚è¿™ä¸ªåŸå‹å¯¹è±¡ç§°ä¸º**éšå¼åŸå‹å¯¹è±¡**ã€‚

éšå¼åŸå‹å¯¹è±¡çš„ä½œç”¨åœ¨äºï¼Œå½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡å†…éƒ¨ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šä»å®ƒçš„ `__proto__` å±æ€§æ‰€æŒ‡å‘çš„ï¼ˆåŸå‹ï¼‰å¯¹è±¡ä¸­å¯»æ‰¾ï¼ˆåŸå‹ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼‰ï¼Œå¦‚æœåŸå‹å¯¹è±¡ä¸­ä¹Ÿæ‰¾ä¸åˆ°ï¼Œå°±ä¼šç»§ç»­åœ¨è¯¥åŸå‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸­æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°å±æ€§æˆ–æ–¹æ³•ä¸ºæ­¢ï¼Œæˆ–è€…æŸ¥æ‰¾åˆ°é¡¶å±‚åŸå‹å¯¹è±¡ `null`ï¼Œå°±ç»“æŸæŸ¥æ‰¾ï¼Œè¿”å› `undefined`ã€‚

æ•´ä¸ªæŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œä»å½“å‰å¯¹è±¡å‡ºå‘æ²¿ç€åŸå‹å¯¹è±¡ï¼ˆ`__proto__`ï¼‰æ„æˆçš„é“¾æ¡æŸ¥æ‰¾ç›¸å…³å±æ€§å’Œæ–¹æ³•ç›´åˆ°ç»“æŸï¼Œè¿™äº›ç›¸äº’å…³è”çš„å¯¹è±¡ç»„æˆçš„é“¾æ¡å°±æ˜¯**åŸå‹é“¾**ã€‚

## æ„é€ å‡½æ•°

![](/blog/assets/images/æ„é€ å‡½æ•°.svg)

å±æ€§ `constructor` ä¹Ÿæ˜¯å¯¹è±¡æ‰æ‹¥æœ‰çš„ï¼Œå®ƒæ˜¯ä»ä¸€ä¸ªå¯¹è±¡æŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œå«ä¹‰å°±æ˜¯æŒ‡å‘è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰æ„é€ å‡½æ•°ï¼ˆæœ¬èº«æ‹¥æœ‰æˆ–ç»§æ‰¿è€Œæ¥ï¼Œç»§æ‰¿è€Œæ¥çš„è¦ç»“åˆ `__proto__` å±æ€§æŸ¥çœ‹ä¼šæ›´æ¸…æ¥šç‚¹ï¼‰ï¼Œä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡º `Function` è¿™ä¸ªå¯¹è±¡æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„æ„é€ å‡½æ•°å°±æ˜¯å®ƒè‡ªå·±ï¼ˆå› ä¸º `Function` å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œæ‰€æœ‰å‡½æ•°å’Œå¯¹è±¡æœ€ç»ˆéƒ½æ˜¯ç”± `Function` æ„é€ å‡½æ•°å¾—æ¥ï¼Œæ‰€ä»¥ `constructor` å±æ€§çš„ç»ˆç‚¹å°±æ˜¯ `Function` è¿™ä¸ªå‡½æ•°ã€‚

## åŸå‹å¯¹è±¡

åŸå‹å¯¹è±¡å³ä¸ºå½“å‰å®ä¾‹å¯¹è±¡çš„çˆ¶å¯¹è±¡

|**æ˜¾å¼åŸå‹å¯¹è±¡**|**éšå¼åŸå‹å¯¹è±¡**|
|:---|:---|
|å±æ€§ `prototype`|å±æ€§ `__proto__`
|å‡½æ•°ç‹¬æœ‰|å¯¹è±¡ç‹¬æœ‰ï¼ˆå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå› æ­¤å‡½æ•°ä¹Ÿæœ‰è¯¥å±æ€§ï¼‰|
|å®šä¹‰å‡½æ•°æ—¶è¢«è‡ªåŠ¨èµ‹å€¼ï¼Œå€¼é»˜è®¤ä¸º `{}`|åœ¨åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶è¢«è‡ªåŠ¨æ·»åŠ ï¼Œå¹¶èµ‹å€¼ä¸ºæ„é€ å‡½æ•°çš„ `prototype` å€¼|
|ç”¨äºå®ç°åŸºäºåŸå‹çš„ç»§æ‰¿ä¸å±æ€§çš„å…±äº«|æ„æˆåŸå‹é“¾ï¼ŒåŒæ ·ç”¨äºå®ç°åŸºäºåŸå‹çš„ç»§æ‰¿|

ğŸŒ° ä»£ç ç¤ºä¾‹ï¼šè®¿é—®åŸå‹é“¾ä¸­çš„åŸå‹å¯¹è±¡

```js
const Foo = function () {};

const foo = new Foo();

// æ„é€ å‡½æ•° Foo {} æ˜¯å‡½æ•° foo çš„åŸå‹å¯¹è±¡
console.log(foo.__proto__);

// æ„é€ å‡½æ•° Object {} æ˜¯å‡½æ•° Function çš„åŸå‹å¯¹è±¡
console.log(foo.__proto__.__proto__);

// åŸå‹é“¾é¡¶å±‚
console.log(foo.__proto__.__proto__.__proto__);
// null
```

**åŸå‹é“¾ä¸­æŸ¥æ‰¾å±æ€§æ–¹æ³•å’Œè®¿é—®åŸå‹é“¾ä¸­çš„åŸå‹å¯¹è±¡çš„åŒºåˆ«**

- åœ¨åŸå‹é“¾ä¸­æŸ¥æ‰¾å±æ€§æˆ–æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ç›¸å…³å±æ€§æˆ–æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ `undefined`ï¼Œè¡¨ç¤ºåŸå‹é“¾ä¸­æ²¡æœ‰è¯¥å±æ€§æˆ–æ–¹æ³•ã€‚
- è€Œé€šè¿‡è®¿é—®åŸå‹é“¾ä¸­çš„åŸå‹å¯¹è±¡ï¼Œåˆ°è¾¾åŸå‹é“¾ç»ˆç‚¹ï¼Œå³ `Object.prototype` çš„å€¼ä¸º `null`ã€‚

## åŸå‹å¯¹è±¡çš„æŒ‡å‘

`__proto__` çš„æŒ‡å‘å–å†³äºå¯¹è±¡åˆ›å»ºæ—¶çš„å®ç°æ–¹å¼ã€‚

### å­—é¢é‡æ–¹å¼

å½“é€šè¿‡å­—é¢é‡æ–¹å¼åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå®ƒçš„åŸå‹å°±æ˜¯ `Object.prototype`ã€‚

è™½ç„¶æˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®å†…ç½®å±æ€§ `__proto__`ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ Object.getPrototypeOf() æˆ–å¯¹è±¡çš„å±æ€§ `__proto__` è·å–å¯¹è±¡çš„åŸå‹ã€‚

```js
const foo = {};

console.log(foo.__proto__ === Object.prototype);
// true

console.log(Object.getPrototypeOf(foo) === Object.prototype);
// true
```

### æ„é€ å™¨æ–¹å¼

```js
const Foo = function () {};

const foo = new Foo();

console.log(foo.__proto__ === Foo.prototype);
// true

console.log(Object.getPrototypeOf(foo) === Foo.prototype);
// true
```

### Object.create æ–¹å¼

é€šè¿‡ `Object.create()` æ–¹å¼åˆ›å»ºçš„å¯¹è±¡ä¼šä»¥ä¼ å…¥çš„å¯¹è±¡å‚æ•°ä¸ºå¯¹è±¡çš„åŸå‹ã€‚

```js
const foo = {};

const bar = Object.create(foo);

console.log(bar.__proto__ === foo);
```

## åŸå‹å¯¹è±¡ä¸å®ä¾‹

é€šè¿‡ `instanceof` æ“ä½œç¬¦å¯ä»¥ç¡®å®šåŸå‹ä¸å®ä¾‹çš„å…³ç³»ã€‚

```js
// å‡è®¾ instanceof æ“ä½œç¬¦å·¦è¾¹æ˜¯ L å³è¾¹æ˜¯ R
L instanceof R

// instanceof è¿ç®—æ—¶ é€šè¿‡åˆ¤æ–­ L çš„åŸå‹é“¾æ˜¯å¦å­˜åœ¨ R.prototype
L.__proto__.__proto__... === R.prototype
```

>[!warning]
>`instanceof` æ“ä½œç¬¦ä¼šé€’å½’æŸ¥æ‰¾ L çš„åŸå‹é“¾ï¼Œå³ `L.__proto__.__proto__.__proto__...` ç›´åˆ°æ‰¾åˆ°äº†æˆ–è€…åˆ°è¾¾é¡¶å±‚ä¸ºæ­¢ã€‚

æ„é€ å™¨ `Function` çš„æ„é€ å™¨æ˜¯å®ƒè‡ªèº«ï¼š

```js
Function.constructor === Function; // true
```

æ„é€ å™¨ `Object` çš„æ„é€ å™¨æ˜¯ `Function`ï¼ˆå› æ­¤å¯å¾—æ‰€æœ‰æ„é€ å™¨çš„ `constructor` éƒ½æŒ‡å‘ `Function`ï¼‰

```js
Object.constructor === Function; // true
```

æ„é€ å™¨ Function çš„ `[[Prototype]]` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åŒ¿åå‡½æ•°

```js
console.log(Function.__proto__); // function(){}
```

è¿™ä¸ªç‰¹æ®Šçš„åŒ¿åå‡½æ•°çš„ `[[Prototype]]` æŒ‡å‘ Object çš„ `prototype` åŸå‹ã€‚

```js
Function.__proto__.__proto__ === Object.prototype; // true
```

`Object` çš„ `[[Prototype]]` æŒ‡å‘ `Function` çš„ `prototype` ä¹Ÿå°±æ˜¯ä¸Šè¿°çš„ç‰¹æ®Šçš„åŒ¿åå‡½æ•°

```js
Object.__proto__ === Function.prototype; // true

Function.prototype === Function.__proto__; // true
```

å†…ç½®å¯¹è±¡ `Function` å’Œ `Object` çš„å…³ç³»ï¼š

```js
Function instanceof Object; // true
Object instanceof Function; // true
```

å…¶ä»–æ ‡å‡†å†…ç½®å¯¹è±¡çš„å­—é¢é‡åŸå‹é“¾å…³ç³»ï¼š

```js
console.log(true.__prto__.__proto__ === Object.prototype);

console.log((123).__proto__.__proto__ === Object.prototype);

console.log('String'.__proto__.__proto__ === Object.prototype);

console.log([].__proto__.__proto__ === Object.prototype);

console.log({}.__proto__ === Object.prototype);
```

æ€»ç»“ï¼š

- æ‰€æœ‰çš„æ„é€ å™¨çš„ `constructor` éƒ½æŒ‡å‘ `Function`
- `Function` çš„ `prototype` æŒ‡å‘ä¸€ä¸ªç‰¹æ®ŠåŒ¿åå‡½æ•°ï¼Œè€Œè¿™ä¸ªç‰¹æ®ŠåŒ¿åå‡½æ•°çš„ `__proto__` æŒ‡å‘ `Object.prototype`
