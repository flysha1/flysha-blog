---
order: 2
date: 2018-01-01
category:
  - å‰ç«¯æŠ€æœ¯
tag:
  - JavaScript
---

# ç±»çš„ç»§æ‰¿

ç»§æ‰¿ï¼Œæ˜¯å­ç±»ç»§æ‰¿çˆ¶ç±»çš„ç‰¹å¾å’Œè¡Œä¸ºï¼Œä½¿å¾—å­ç±»å¯¹è±¡å…·æœ‰çˆ¶ç±»çš„å®ä¾‹åŸŸå’Œæ–¹æ³•ã€‚ ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚

## ä½¿ç”¨æ–¹æ³•

ä¸ ES5 é€šè¿‡ä¿®æ”¹åŸå‹é“¾å®ç°ç»§æ‰¿ä¸åŒï¼Œç±»é€šè¿‡ `extends` å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚

```js
class Parent {}

class Child extends Parent {
  constructor() {
    super();
  }
}
```

>[!warning]
>å­ç±»å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ `super` æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºå­ç±»è‡ªèº«çš„ `this` æŒ‡å‘ï¼Œå¿…é¡»å…ˆé€šè¿‡çˆ¶ç±»çš„æ„é€ å‡½æ•°å®Œæˆå¡‘é€ ï¼Œå¾—åˆ°ä¸çˆ¶ç±»åŒæ ·çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œç„¶åå†å¯¹å…¶è¿›è¡ŒåŠ å·¥ï¼ŒåŠ ä¸Šå­ç±»è‡ªå·±çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ã€‚å¦‚æœä¸è°ƒç”¨ `super` æ–¹æ³•ï¼Œå­ç±»å°±æ— æ³•å¾—åˆ° `this` æŒ‡å‘ã€‚

å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ˜¾å¼å®šä¹‰ï¼Œä»»ä½•ä¸€ä¸ªå­ç±»éƒ½æœ‰æ„é€ å‡½æ•°ã€‚

å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œ**åªæœ‰è°ƒç”¨ `super` ä¹‹åï¼Œæ‰å¯ä»¥ä½¿ç”¨ `this` å…³é”®å­—**ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

è¿™æ˜¯å› ä¸ºå­ç±»å®ä¾‹çš„æ„å»ºï¼ŒåŸºäºçˆ¶ç±»å®ä¾‹ï¼Œåªæœ‰ `super` æ–¹æ³•æ‰èƒ½è°ƒç”¨çˆ¶ç±»å®ä¾‹ã€‚

```js
class Parent {
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }
}

class Child extends Parent {
  constructor(x, y, age) {
    this.age = age;
    // ReferenceError å¼•ç”¨é”™è¯¯
    // é”™è¯¯åŸå› ï¼šåœ¨è°ƒç”¨ super å‰è°ƒç”¨ this

    super(x, y);

    // æ­£ç¡®
    this.age = age;
  }
}
```

## è®¿é—®çˆ¶ç±»

é€šè¿‡ [Object.getPrototypeOf()](/blog/å‰ç«¯æŠ€æœ¯/JavaScript/å†…ç½®å¯¹è±¡/Object/getPrototypeOf.html) æ–¹æ³•å¯ä»¥ç”¨æ¥ä»å­ç±»ä¸Šè·å–çˆ¶ç±»ã€‚

```js
Object.getPrototypeOf(Child) === Parent;
```

å› æ­¤ï¼Œå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•åˆ¤æ–­ï¼Œä¸€ä¸ªç±»æ˜¯å¦ç»§æ‰¿äº†å¦ä¸€ä¸ªç±»ã€‚

## super

`super` å…³é”®å­—ï¼Œæ—¢å¯å½“ä½œå‡½æ•°ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¯¹è±¡ä½¿ç”¨ã€‚

å½“ `super` ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œä»£è¡¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚

ES6 è¦æ±‚ï¼Œå­ç±»çš„æ„é€ å‡½æ•°ç»§æ‰¿çˆ¶ç±»æ—¶å¿…é¡»æ‰§è¡Œä¸€æ¬¡ `super` å‡½æ•°ã€‚è€Œä¸”ï¼Œ`super()` å‡½æ•°ä»…èƒ½åœ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

```js
class Parent {}

class Child extends Parent {
  constructor() {
    super();
  }
}
```

è™½ `super` ä»£è¡¨äº†çˆ¶ç±» `Parent` çš„ **æ„é€ å‡½æ•°**ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å­ç±» `Child` çš„å®ä¾‹ï¼Œå³ `super` å†…éƒ¨çš„ `this` æŒ‡çš„æ˜¯ `Child`ï¼Œå› æ­¤ `super()` åœ¨è¿™é‡Œç›¸å½“äºï¼š

```js
Parent.prototype.constructor.call(this);
```

å½“ `super` ä½œä¸ºå¯¹è±¡æ—¶ï¼š

- åœ¨æ™®é€šæ–¹æ³•ä¸­ï¼ŒæŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡
- åœ¨é™æ€æ–¹æ³•ä¸­ï¼ŒæŒ‡å‘çˆ¶ç±»

### æ™®é€šæ–¹æ³•

åœ¨æ™®é€šæ–¹æ³•ä¸­ï¼Œ`super` æŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ã€‚

```js
class Parent {
  console() {
    return 'Hello world!';
  }
}

class Child extends Parent {
  constructor() {
    super();

    const result = super.console();

    console.log(result);
    // Hello world!
  }
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå­ç±» `Child` å½“ä¸­çš„ `super.console()`ï¼Œå°±æ˜¯å°† `super` å½“ä½œä¸€ä¸ªå¯¹è±¡ä½¿ç”¨ã€‚è¿™æ—¶ï¼Œ`super` åœ¨æ™®é€šæ–¹æ³•ä¹‹ä¸­ï¼ŒæŒ‡å‘ `Parent.prototype`ï¼Œæ‰€ä»¥ `super.console()` å°±ç›¸å½“äº `Parent.prototype.console()`ã€‚

>[!warning]
>ES6 è§„å®šï¼Œåœ¨å­ç±»æ™®é€šæ–¹æ³•ä¸­é€šè¿‡ `super` è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨çš„ `this` æŒ‡å‘å½“å‰çš„å­ç±»å®ä¾‹ã€‚

ğŸŒ° ç¤ºä¾‹ï¼š

```js
class Parent {
  constructor() {
    this.x = 1;
  }
  print() {
    console.log(this.x);
  }
}

class Child extends Parent {
  constructor() {
    super();
    this.x = 2;
  }
  console() {
    super.print();
    // print æ–¹æ³•æ‰§è¡Œæ—¶ this å®é™…æŒ‡å‘çš„æ˜¯å­ç±»å®ä¾‹
  }
}

const child = new Child();

child.console();
// 2
```

### é™æ€æ–¹æ³•

åœ¨å­ç±»çš„é™æ€æ–¹æ³•ä¸­é€šè¿‡ `super` è°ƒç”¨çˆ¶ç±»çš„é™æ€æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨çš„ `this` æŒ‡å‘çš„æ˜¯ **å½“å‰çš„å­ç±»ï¼Œè€Œä¸æ˜¯å­ç±»çš„å®ä¾‹**ã€‚

```js
class Parent {
  constructor() {
    this.x = 1;
  }
  static console() {
    console.log(this.x);
  }
}

class Child extends Parent {
  constructor() {
    super();
    this.x = 2;
  }
  static print() {
    super.console();
  }
}

Child.x = 3;

Child.print();
// 3
```

>[!warning]
>ä½¿ç”¨ `super` çš„æ—¶å€™ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šæ˜¯ä½œä¸ºå‡½æ•°ï¼Œè¿˜æ˜¯ä½œä¸ºå¯¹è±¡è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

```js
class Parent {}

class Child extends Parent {
  constructor() {
    super();
    console.log(super);
    // æŠ¥é”™
  }
}
```

åœ¨å­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³• `this` æŒ‡å‘æ€»ç»“ï¼š

- `super` ä½œä¸ºå¯¹è±¡æ—¶
  - åœ¨å­ç±»çš„ **æ™®é€šæ–¹æ³•**
    - `super` æŒ‡å‘ **çˆ¶ç±»çš„åŸå‹å¯¹è±¡** `Parent.prototype`
    - é€šè¿‡ `super` è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨çš„ `this` æŒ‡å‘å½“å‰çš„ **å­ç±»å®ä¾‹**
  - åœ¨å­ç±»çš„ **é™æ€æ–¹æ³•**
    - `super` æŒ‡å‘ **çˆ¶ç±»**ï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„åŸå‹å¯¹è±¡
    - é€šè¿‡ `super` è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨çš„ `this` æŒ‡å‘å½“å‰ **å­ç±»**ï¼Œè€Œä¸æ˜¯å­ç±»çš„å®ä¾‹

## ç±»çš„åŸå‹å¯¹è±¡

å¤§å¤šæ•°æµè§ˆå™¨çš„ ES5 å®ç°ä¹‹ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ `__proto__` å±æ€§ï¼ŒæŒ‡å‘å¯¹åº”çš„æ„é€ å‡½æ•°çš„ `prototype` å±æ€§ã€‚

`Class` ä½œä¸ºæ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼ŒåŒæ—¶æœ‰ `prototype` å±æ€§å’Œ `__proto__` å±æ€§ï¼Œå› æ­¤åŒæ—¶å­˜åœ¨ä¸¤æ¡ç»§æ‰¿é“¾ã€‚

1. å­ç±»çš„ `__proto__` å±æ€§ï¼Œè¡¨ç¤º æ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘ çˆ¶ç±»ã€‚
2. å­ç±»çš„ `prototype` å±æ€§çš„ `__proto__` å±æ€§ï¼Œè¡¨ç¤º æ–¹æ³•çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘ çˆ¶ç±»çš„ `prototype` å±æ€§ã€‚

```mermaid
---
title: ç±»çš„åŸå‹å¯¹è±¡ç»§æ‰¿å…³ç³»
---
flowchart TB
    Parent-->|prototype|Parent.prototype
    Child-->|__ __proto__ __ |Parent
    Child-->|prototype|Child.prototype
    Child.prototype-->|"__ __proto__ __"|Parent.prototype
    

```

```js
class Parent {}

class Child extends Parent {}

console.log(Child.__proto__ === Parent);
// true

console.log(Child.prototype.__proto__ === Parent.prototype);
// true
```

ç±»çš„ç»§æ‰¿æ˜¯æŒ‰ç…§ä¸‹é¢çš„æ¨¡å¼å®ç°çš„ï¼š

```js
class Parent {}

class Child {}

// 1. Child å­ç±»çš„å®ä¾‹å¯¹è±¡ç»§æ‰¿ Parent çˆ¶ç±»çš„å®ä¾‹å¯¹è±¡
Object.setPropertyOf(Child.prototype, Parent.prototype);

// 2. Child å­ç±»ç»§æ‰¿ Parent çˆ¶ç±»çš„é™æ€å±æ€§
Object.setPropertyOf(Child, Parent);

const child = new Child();
```

[Object.setPrototypeOf](/blog/å‰ç«¯æŠ€æœ¯/JavaScript/å†…ç½®å¯¹è±¡/Object/setPrototypeOf.html) æ–¹æ³•çš„åº•å±‚å®ç°

ä¸Šè¿°å®ç°ç­‰ä»·äºï¼š

```js
Object.setPropertyOf(Child.prototype, Parent.prototype);
// ç­‰ä»·äº
Child.prototype.__proto__ = Parent.prototype;

Object.setPropertyOf(Child, Parent);
// ç­‰ä»·äº
Child.__proto__ = Parent;
```

è¿™ä¸¤æ¡ç»§æ‰¿é“¾ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼š

- ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå­ç±»çš„éšå¼åŸå‹å¯¹è±¡ï¼ˆ`__proto__` å±æ€§ï¼‰æ˜¯çˆ¶ç±»ï¼ˆ`Parent`ï¼‰
- ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå­ç±»çš„æ˜¾å¼åŸå‹å¯¹è±¡ï¼ˆ`prototype` å±æ€§ï¼‰æ˜¯çˆ¶ç±»çš„æ˜¾å¼åŸå‹å¯¹è±¡ï¼ˆ`prototype` å±æ€§ï¼‰çš„å®ä¾‹

**å­ç±»ç»§æ‰¿å†…ç½®å¯¹è±¡**

```js
class Child extends Object {}

// ç›¸å½“äº
console.log(Child.__proto__ === Object);
// true
console.log(Child.prototype.__proto__ === Object.prototype);
// true
```

è¿™ç§æƒ…å†µä¸‹ï¼Œ`Child` å…¶å®å°±æ˜¯æ„é€ å‡½æ•° `Object` çš„æ‹·è´ï¼Œ`Child` çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰å°±æ˜¯ `Object` çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ã€‚

**ä¸å­˜åœ¨ç»§æ‰¿å…³ç³»**

```js
class Parent {}

Parent.__proto__ === Function.prototype;
// true
Parent.prototype.__proto__ === Object.prototype;
// true
```

è¿™ç§æƒ…å†µä¸‹ï¼Œ`Parent` ä½œä¸ºä¸€ä¸ªåŸºç±»ï¼ˆå³ä¸å­˜åœ¨ä»»ä½•ç»§æ‰¿ï¼‰ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œæ‰€ä»¥ç›´æ¥ç»§æ‰¿ `Function.prototype`ã€‚

ä½†æ˜¯ï¼Œ`Parent` å®ä¾‹åŒ–åè¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼ˆå³ `Object` å®ä¾‹ï¼‰ï¼Œæ‰€ä»¥ `Parent.prototype.__proto__` æŒ‡å‘æ„é€ å‡½æ•°ï¼ˆ`Object`ï¼‰çš„ `prototype` å±æ€§ã€‚

## å†…ç½®å¯¹è±¡çš„ç»§æ‰¿

å†…ç½®å¯¹è±¡ï¼ˆåˆç§°åŸç”Ÿæ„é€ å‡½æ•°ï¼‰æ˜¯æŒ‡å†…ç½®çš„æ„é€ å‡½æ•°ï¼Œé€šå¸¸ç”¨æ¥ç”Ÿæˆæ•°æ®ç»“æ„ã€‚

è¿‡å»ï¼ŒåŸç”Ÿæ„é€ å‡½æ•°æ˜¯æ— æ³•ç»§æ‰¿çš„ï¼Œæ¯”å¦‚ï¼Œä¸èƒ½è‡ªå·±å®šä¹‰ä¸€ä¸ª `Array` çš„å­ç±»ã€‚ä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸ºå­ç±»æ— æ³•è·å¾—åŸç”Ÿæ„é€ å‡½æ•°çš„å†…éƒ¨å±æ€§ï¼Œé€šè¿‡ `Array.apply()` æˆ–è€…åˆ†é…ç»™åŸå‹å¯¹è±¡éƒ½ä¸è¡Œã€‚åŸç”Ÿæ„é€ å‡½æ•°ä¼šå¿½ç•¥ `apply` æ–¹æ³•ä¼ å…¥çš„ `this`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸç”Ÿæ„é€ å‡½æ•° `this` æ— æ³•ç»‘å®šï¼Œå¯¼è‡´æ‹¿ä¸åˆ°å†…éƒ¨å±æ€§ã€‚

è€Œåœ¨ ES6 ä¸­å…è®¸ç»§æ‰¿åŸç”Ÿæ„é€ å‡½æ•°å®šä¹‰å­ç±»ï¼Œå› ä¸º ES6 æ˜¯å…ˆæ–°å»ºçˆ¶ç±»çš„å®ä¾‹å¯¹è±¡ `this` ï¼Œç„¶åå†ç”¨å­ç±»çš„æ„é€ å‡½æ•°ä¿®é¥° `this`ï¼Œä½¿å¾—çˆ¶ç±»çš„æ‰€æœ‰è¡Œä¸ºéƒ½å¯ä»¥ç»§æ‰¿ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç»§æ‰¿ `Array` çš„ä¾‹å­ã€‚

```js
class SubArray extends Array {
  constructor(...args) {
    super(...args);
  }
}

var arr = new SubArray();
arr[0] = 12;
console.log(arr.length);
// 1

arr.length = 0;
console.log(arr[0]);
// undefined
```

ä¸Šé¢çš„ä¾‹å­è¯´æ˜ï¼Œ`extends` å…³é”®å­—ä¸ä»…å¯ä»¥ç”¨æ¥ç»§æ‰¿ç±»ï¼Œè¿˜å¯ä»¥ç”¨æ¥ç»§æ‰¿åŸç”Ÿçš„æ„é€ å‡½æ•°ã€‚å› æ­¤å¯ä»¥åœ¨åŸç”Ÿæ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ã€‚

>[!warning]
>ç»§æ‰¿ `Object` çš„å­ç±»ï¼Œæœ‰ä¸€ä¸ªè¡Œä¸ºå·®å¼‚ã€‚

```js
class SubObject extends Object {
  constructor() {
    super(...arguments);
  }
}
const obj = new SubObject({ attr: true });

obj.attr === true;
// false
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œ`SubObject` ç»§æ‰¿äº† `Object` ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡ `super` æ–¹æ³•å‘çˆ¶ç±» `Object` ä¼ å‚ã€‚è¿™æ˜¯å› ä¸º ES6 æ”¹å˜äº† `Object` æ„é€ å‡½æ•°çš„è¡Œä¸ºï¼Œä¸€æ—¦å‘ç° `Object` æ–¹æ³•ä¸æ˜¯é€šè¿‡ `new Object()` è¿™ç§å½¢å¼è°ƒç”¨ï¼ŒES6 è§„å®š `Object` æ„é€ å‡½æ•°ä¼šå¿½ç•¥å‚æ•°ã€‚
